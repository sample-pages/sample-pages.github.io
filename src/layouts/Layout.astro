---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "katex/dist/katex.min.css";
import "remixicon/fonts/remixicon.css";
import "../styles/output.css";

const { title } = Astro.props;

// src/layouts/Layout.astro

interface Props {
  title: string;
  description?: string;
  image?: string;
}

interface Props {
  frontmatter?: {
    title: string;
    image?: string;
  };
}

// 1. Markdownから来た場合は frontmatter にデータが入っている
// 2. Astroファイルから来た場合は props に直接データが入っている
const { frontmatter } = Astro.props;

// どちらか存在する方から値を取り出す（Markdown優先の記述例）
const image = frontmatter?.image || Astro.props.image || "/default-ogp.jpg";

// (以前説明したURL設定)
const ogImageURL = new URL(image, Astro.url);
---

<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="../styles/output.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
      integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0"
      crossorigin="anonymous"
    />
    <link rel="icon" type="image/png" href="/images/logo.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:title" content={title} />
    <meta name="twitter:image" content={ogImageURL} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />

    <!-- Google tag (gtag.js) -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K72QWT4T66"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-K72QWT4T66');
</script>
    
    <title>{title}</title>
    <meta name="description" content="「第8回うぃーすた全国交流会」を2026年7月18日(土)〜19日(日)に大阪にて開催します！">
    <script>
      window.addEventListener('DOMContentLoaded', () => {
    // 表示済みチェック
    if (sessionStorage.getItem("welcomeShown")) return;
    sessionStorage.setItem("welcomeShown", "true");
  
    // 画像をプリロード
    const img = new Image();
    img.src = '/images/p0126_l.png';

    // ==========================================
    //  CSSスタイル定義
    // ==========================================
    const style = document.createElement('style');
    style.innerHTML = `
      .intro-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-size: cover !important;
        z-index: 9999;
        opacity: 0;
        transition: opacity 0.5s;
      }

      .intro-container {
        display: flex;
        position: relative;
        top: -20px;
        flex-direction: row-reverse;
        gap: 3rem; 
      }

      .intro-text {
        color: black;
        opacity: 0;
        transition: opacity 1s;
        writing-mode: vertical-rl;
        text-align: left;
        font-size: 1.5rem; 
        line-height: 1.8;
      }

      .intro-skip-btn {
        position: absolute;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: transparent;
        border: 1.5px solid #000;
        border-radius: 50%;
        color: #000;
        cursor: pointer;
        z-index: 10000;
        transition: background-color 0.3s, transform 0.2s;
        font-family: "Zen Kaku Gothic New", "Makinas-4-Flat", sans-serif;
        font-weight: bold;
        text-decoration: none;
        width: 100px;
        height: 100px;
        bottom: 60px;
        right: 60px;
        font-size: 16px;
      }

      .intro-skip-btn:hover {
        background-color: rgba(255,255,255,0.3);
      }

      @media (max-width: 768px) {
        .intro-container {
          gap: 1.5rem;
        }
        .intro-text {
          font-size: 1.1rem;
          line-height: 1.5;
        }
        .intro-skip-btn {
          width: 80px;
          height: 80px;
          bottom: 80px;
          right: 30px;
          font-size: 14px;
        }
      }
    `;
    document.head.appendChild(style);

    // ==================================================
    //  オーバーレイを閉じる関数（ヘッダー強制表示付き）
    // ==================================================
    const removeOverlay = () => {
      overlay.style.opacity = "0";

      // --- ★ヘッダーを強制的に表示させる処理 ---
      const header = document.getElementById("mainHeader");
      if (header) {
        // スタイルを上書きして即座に見えるようにする
        header.style.opacity = "1";
        header.style.transform = "translateY(0)";
        header.classList.add("slide-in");
      }

      // 要素の削除
      setTimeout(() => {
        if (overlay.parentNode) overlay.remove();
        if (style.parentNode) style.remove();
      }, 1000);
    };

    // --- オーバーレイ作成 ---
    const overlay = document.createElement('div');
    overlay.classList.add('intro-overlay');
    overlay.style.background = `linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)), url('/images/p0126_l.png') no-repeat center center`;
    document.body.appendChild(overlay);
  
    setTimeout(() => overlay.style.opacity = '1', 50);
  
    // --- 文字コンテナ作成 ---
    const container = document.createElement('div');
    container.classList.add('intro-container');
  
    const createLine = (text) => {
      const div = document.createElement('div');
      div.textContent = text;
      div.classList.add("zen-kaku-gothic-new", "intro-text");
      return div;
    };
  
    const line1 = createLine("吃音のある同年代の仲間たちと");
    const line2 = createLine("悩みや夢を語り合う、");
    const line3 = createLine("かけがえのない時間を過ごしてみませんか？");
  
    container.appendChild(line1);
    container.appendChild(line2);
    container.appendChild(line3);
    overlay.appendChild(container);

    // ==========================================
    //  ★Skipボタン作成（修正版）
    // ==========================================
    const skipBtn = document.createElement('button');
    skipBtn.textContent = 'Skip >>';
    skipBtn.type = 'button'; // ボタンタイプを明示
    skipBtn.classList.add('intro-skip-btn');

    // ★クリック時の処理：移動せずに閉じるだけ
    skipBtn.addEventListener('click', (e) => {
        e.preventDefault(); // 予期せぬ動作を防止
        removeOverlay();    // 画面を閉じてヘッダーを表示
    });

    overlay.appendChild(skipBtn);
  
    // --- テキストのアニメーション ---
    setTimeout(() => line1.style.opacity = "1", 800);
    setTimeout(() => line2.style.opacity = "1", 2500);
    setTimeout(() => line3.style.opacity = "1", 4000);
  
    // --- 自動終了タイマー ---
    setTimeout(() => {
        if (overlay.parentNode) {
            removeOverlay();
        }
    }, 7000);
});

      // --- トップへ戻るボタン ---
      document.addEventListener("DOMContentLoaded", () => {
  const backToTopButton = document.getElementById('backToTop');
  if (!backToTopButton) return;

  backToTopButton.addEventListener('click', () => {
    // これだけでブラウザが最適に滑らかにスクロールしてくれます
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
});
      </script>
      
      
  </head>

  <body class="flex flex-col m-0">
    <Header />
    <main class="flex-grow min-h-0">
      <slot />
    </main>
    <Footer />
  </body>
</html>

