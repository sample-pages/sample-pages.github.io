---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "katex/dist/katex.min.css";
import "remixicon/fonts/remixicon.css";
import "../styles/output.css";

const { title } = Astro.props;

// src/layouts/Layout.astro

interface Props {
  title: string;
  description?: string;
  image?: string;
}

interface Props {
  frontmatter?: {
    title: string;
    image?: string;
  };
}

// 1. Markdownから来た場合は frontmatter にデータが入っている
// 2. Astroファイルから来た場合は props に直接データが入っている
const { frontmatter } = Astro.props;

// どちらか存在する方から値を取り出す（Markdown優先の記述例）
const image = frontmatter?.image || Astro.props.image || "/images/card.png";

// (以前説明したURL設定)
const ogImageURL = new URL(image, Astro.url);

---

<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="../styles/output.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
      integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0"
      crossorigin="anonymous"
    />
    <link rel="icon" type="image/png" href="/images/logo.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:title" content={title} />
    <meta name="twitter:image" content={ogImageURL} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    
    <title>{title}</title>
    <meta name="description" content="「第8回うぃーすた全国交流会」を2026年7月18日(土)〜19日(日)に大阪にて開催します！">
    <script>
(function() {
    // すでに表示済みなら何もしない（画面はそのまま表示される）
    if (sessionStorage.getItem("welcomeShown")) return;

    // まだ表示していない場合、画面描画が始まる前に「真っ白」にして隠す
    // これにより「下にある画面が一瞬見える」のを防ぎます
    document.documentElement.style.visibility = 'hidden';
    document.documentElement.style.opacity = '0';
})();


window.addEventListener('DOMContentLoaded', () => {
    // 表示済みチェック
    // (万が一、上の即時実行関数が動く前にDOM構築が終わった場合などの保険)
    if (sessionStorage.getItem("welcomeShown")) {
        document.documentElement.style.visibility = '';
        document.documentElement.style.opacity = '';
        return;
    }
    
    sessionStorage.setItem("welcomeShown", "true");

    // ==========================================
    //  設定
    // ==========================================
    const BUBBLE_IMAGES = [
        '/images/bubble_1.png', 
        '/images/bubble_2.png', 
        '/images/bubble_3.png'
    ];

    // ==========================================
    //  CSSスタイル定義
    // ==========================================
    const style = document.createElement('style');
    style.innerHTML = `
      .intro-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100svh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-size: cover !important;
        z-index: 9999;
        opacity: 1; /* 初期状態で見えるように */
        transition: opacity 0.5s;
        overflow: hidden;
      }
      .intro-container {
        display: flex;
        position: relative;
        justify-content: center;
  align-items: flex-start;
        flex-direction: row-reverse;
        gap: 3rem; 
        z-index: 2;
        height: 100svh;
        padding-top: 120px; /* 数値は調整してください */
  box-sizing: border-box; /* paddingを含めて高さを計算させるおまじない */
      }
      .intro-text {
        color: black;
        opacity: 0;
        transition: opacity 1s;
        writing-mode: vertical-rl;
        text-align: left;
        font-size: 1.5rem; 
        line-height: 1.8;
      }
      .intro-skip-btn {
        position: absolute;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: transparent;
        border: 1.5px solid #000;
        border-radius: 50%;
        color: #000;
        cursor: pointer;
        z-index: 10000;
        transition: background-color 0.3s, transform 0.2s;
        font-family: "Zen Kaku Gothic New", "Makinas-4-Flat", sans-serif;
        font-weight: bold;
        text-decoration: none;
        width: 100px;
        height: 100px;
        bottom: 60px;
        right: 60px;
        font-size: 16px;
      }
      .intro-skip-btn:hover {
        background-color: rgba(255,255,255,0.3);
      }
      @media (max-width: 768px) {
        .intro-container { gap: 1.5rem; padding-top: 130px;}
        .intro-text { font-size: 1.1rem; line-height: 1.5; }
        .intro-skip-btn { width: 80px; height: 80px; bottom: 60px; right: 40px; font-size: 14px; }
      }

      .bubble {
        position: absolute;
        z-index: 1;
        pointer-events: none;
        opacity: 0;
        object-fit: contain;
        animation: floatUp linear forwards;
      }

      @keyframes floatUp {
        0% {
          transform: translateY(0) translateX(0) scale(0.8);
          opacity: 0;
        }
        5% {
          opacity: 0.9;
        }
        100% {
          transform: translateY(-130vh) translateX(var(--wobble)) scale(1.1);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);

    // ==================================================
    //  オーバーレイ制御
    // ==================================================
    let bubbleInterval;

    const removeOverlay = () => {
      if (bubbleInterval) clearInterval(bubbleInterval);
      overlay.style.opacity = "0";

      const header = document.getElementById("mainHeader");
      if (header) {
        header.style.opacity = "1";
        header.style.transform = "translateY(0)";
        header.classList.add("slide-in");
      }

      setTimeout(() => {
        if (overlay.parentNode) overlay.remove();
        if (style.parentNode) style.remove();
      }, 1000);
    };

    const overlay = document.createElement('div');
    overlay.classList.add('intro-overlay');
    
    
    overlay.style.backgroundColor = "#fff2f2";
    document.body.appendChild(overlay);

    // ==========================================
    //  シャボン玉生成ロジック
    // ==========================================
    const createBubble = (isInitial = false) => {
      if (BUBBLE_IMAGES.length === 0) return;

      const bubble = document.createElement('img');
      const randomIndex = Math.floor(Math.random() * BUBBLE_IMAGES.length);
      bubble.src = BUBBLE_IMAGES[randomIndex] ?? ""; 
      bubble.classList.add('bubble');
      
      const size = Math.random() * 150 + 80; 
      bubble.style.width = `${size}px`;
      bubble.style.height = `${size}px`;
      bubble.style.left = `${Math.random() * 100}%`;
      const wobble = (Math.random() - 0.5) * 250; 
      bubble.style.setProperty('--wobble', `${wobble}px`);
      const duration = Math.random() * 4 + 5; 
      bubble.style.animationDuration = `${duration}s`;

      if (isInitial) {
        const randomBottom = Math.random() * 110 - 10;
        bubble.style.bottom = `${randomBottom}%`;
        bubble.style.opacity = '0.9'; 
      } else {
        bubble.style.bottom = '-250px';
      }

      overlay.appendChild(bubble);

      setTimeout(() => {
        if(bubble.parentNode) bubble.remove();
      }, duration * 1000);
    };

    const initBubbles = () => {
        for(let i = 0; i < 6; i++) {
            createBubble(true);
        }
    };
    initBubbles();

    bubbleInterval = setInterval(() => createBubble(false), 600);


    // --- テキスト系 ---
    const container = document.createElement('div');
    container.classList.add('intro-container');
  
    const createLine = (text) => {
      const div = document.createElement('div');
      div.textContent = text;
      div.classList.add("zen-kaku-gothic-new", "intro-text");
      return div;
    };
  
    const line1 = createLine("吃音のある同年代の仲間たちと");
    const line2 = createLine("悩みや夢を語り合う、");
    const line3 = createLine("かけがえのない時間を過ごしてみませんか？");
  
    container.appendChild(line1);
    container.appendChild(line2);
    container.appendChild(line3);
    overlay.appendChild(container);

    // --- Skipボタン ---
    const skipBtn = document.createElement('button');
    skipBtn.textContent = 'Skip >>';
    skipBtn.type = 'button';
    skipBtn.classList.add('intro-skip-btn');

    skipBtn.addEventListener('click', (e) => {
        e.preventDefault();
        removeOverlay();
    });

    overlay.appendChild(skipBtn);
  
    // --- タイマー系 ---
    setTimeout(() => line1.style.opacity = "1", 800);
    setTimeout(() => line2.style.opacity = "1", 2500);
    setTimeout(() => line3.style.opacity = "1", 4000);
  
    setTimeout(() => {
        if (overlay.parentNode) {
            removeOverlay();
        }
    }, 7000);

    document.documentElement.style.visibility = '';
    document.documentElement.style.opacity = '';
});

      // --- トップへ戻るボタン ---
      document.addEventListener("DOMContentLoaded", () => {
  const backToTopButton = document.getElementById('backToTop');
  if (!backToTopButton) return;

  backToTopButton.addEventListener('click', () => {
    // これだけでブラウザが最適に滑らかにスクロールしてくれます
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  });
});
      </script>

  </head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J7TW1M281F"></script>
<script is:inline>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-J7TW1M281F');
</script>
<script>
  // ユーザーエージェントを取得
  var userAgent = window.navigator.userAgent.toLowerCase();
  
  // Chromeかどうか判定（EdgeやOperaを除外するための条件も含める）
  if (userAgent.indexOf('chrome') != -1 && userAgent.indexOf('edge') == -1 && userAgent.indexOf('opr') == -1) {
    document.body.classList.add('is-chrome');
  }
</script>
  <body class="flex flex-col m-0">
    <Header />
    <main class="flex-grow min-h-0">
      <slot />
    </main>
    <Footer />
  </body>
</html>

