---
const mapContainerId = "map-container";
const center: [number, number] = [135.4330025649711, 34.53298339064751];
const zoom: number = 16;
---

<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>単独マップ表示</title>

  <!-- MapLibre GL CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" />
  <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>

  <!-- MapLibre Geocoder CSS & UMD -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/@maplibre/maplibre-gl-geocoder@latest/dist/maplibre-gl-geocoder.css"
  />
  <script
    src="https://unpkg.com/@maplibre/maplibre-gl-geocoder@latest/dist/maplibre-gl-geocoder.umd.js"
  ></script>

  <style>
    body { margin: 0; padding: 0; }
    #map-container { position: absolute; top: 0; bottom: 0; width: 100%; }
  </style>
</head>

<body>
  <main>
    <div id={mapContainerId}></div>

    <script is:inline define:vars={{ mapContainerId, center, zoom }}>
      window.addEventListener("load", () => {
        const maplibregl = window.maplibregl;

        if (!maplibregl) {
          console.error("MapLibre GL JS が読み込まれていません。");
          return;
        }

        // 地図生成
        const map = new maplibregl.Map({
          container: mapContainerId,
          style: 'https://api.maptiler.com/maps/streets-v4/style.json?key=QecJGOKNw0YEhbCJIvDw',
          center: center,
          zoom: zoom
        });

        // 現在地ボタン
        map.addControl(new maplibregl.GeolocateControl({
          positionOptions: { enableHighAccuracy: true },
          trackUserLocation: true,
          showUserHeading: true
        }));

        // 初期マーカー
        new maplibregl.Marker({ color: '#0000FF' })
          .setLngLat(center)
          .setPopup(new maplibregl.Popup({ offset: 25 })
          .setHTML("<h5>マークされた場所</h5><p>重要な印です</p>"))
          .addTo(map);

        // Geocoder
        const API_KEY = "QecJGOKNw0YEhbCJIvDw";

        if (!window.MaplibreGeocoder) {
          console.error("MaplibreGeocoder が読み込まれていません。");
          return;
        }

        const geocoder = new window.MaplibreGeocoder({
          apiKey: API_KEY,
          maplibregl: maplibregl,
          placeholder: "検索...",
          marker: true,
          autocomplete: true
        });

        map.addControl(geocoder, 'top-right');
      });
    </script>
  </main>
</body>
</html>

