---
import Layout from "../layouts/Layout.astro";

const times = ["7:00","8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"];
const venues = ["ç ”ä¿®å®¤AB", "ç ”ä¿®å®¤C", "å’Œå®¤å°", "å¤§é˜ªå›½éš›ãƒ¦ãƒ¼ã‚¹ãƒ›ã‚¹ãƒ†ãƒ«", "ãƒãƒ¼ãƒ™ã‚­ãƒ¥ãƒ¼ã‚¬ãƒ¼ãƒ‡ãƒ³ç¾½è¡£"];
const venueWidths = [150, 150, 150, 150, 150];
---

<Layout title="ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ« - ç¬¬8å›ã†ãƒãƒ¼ã™ãŸå…¨å›½äº¤æµä¼š">
  <div class="overflow-hidden relative z-[-1] mt-[80px] lg:mt-[78px] bg-[#fffdfd] border-b-[4px] border-red-100 w-full md:h-72 max-md:h-64 flex flex-col justify-center pl-8 zen-kaku-gothic-new">
    <span class="overflow-hidden ml-10 pt-3 max-md:ml-1 text-[50px] font-bold outline-text tracking-widest shiny-slide z-0">
      TIMETABLE
    </span>
    
    <span class="bg-[#fffdfd] mt-3 ml-10 pb-3 h-30 max-md:ml-1 text-[20px] z-10">
      ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«
    </span>
  </div>
  <div class="bg-white/30 text-color zen-kaku-gothic-new text-sm lg:text-base" style="line-height: 2.05;">
    <div class="fade-in margin-contents pt-8 md:px-12 max-md:px-6">
    <div class="h-[15px] md:h-[40px]"></div>
    <div class="ml-1">
      <p class="mb-2">ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
      
      <p class="flex flex-wrap items-center gap-y-1">
        <span class="inline-block w-4 h-4 bg-yellow-300 mr-1 rounded-sm"></span>ï¼šä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº
        
        <span class="inline-block w-4 h-4 bg-green-300 ml-4 mr-1 rounded-sm"></span>ï¼šå­¦ç”Ÿãƒ»ç¤¾ä¼šäºº
        
        <span class="w-full block md:hidden h-0"></span>
        
        <span class="inline-block w-4 h-4 bg-blue-300 ml-0 md:ml-4 mr-1 rounded-sm"></span>ï¼šä¸­é«˜ç”Ÿ
        
        <span class="inline-block w-4 h-4 bg-purple-300 ml-4 mr-1 rounded-sm"></span>ï¼šä¸­é«˜ç”Ÿä¿è­·è€…ã®æ–¹
      </p>
    </div>
        <div class="flex justify-center mt-8">
          <label class="toggle-button-4 relative flex items-center w-[262px] h-[52px] rounded-[25px] border cursor-pointer">
            <input type="checkbox" id="dateToggle" class="absolute opacity-0 w-0 h-0">
        
            <!-- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ -->
            <span class="slider absolute top-1 left-1 w-32 h-10 bg-[#e26161] rounded-full transition-all duration-700 ease-[cubic-bezier(0.4,0,0.2,1)] z-0"></span>
        
            <!-- å·¦æ—¥ä»˜ï¼ˆåˆæœŸå·¦ç«¯ï¼‰ -->
            <span class="text-white date date-left absolute top-1/2 left-1 transform -translate-y-1/2 w-32 h-10 flex items-center justify-center font-semibold z-10 pointer-events-none transition-all duration-700 ease-in-out">
              7æœˆ18æ—¥(<span class="text-blue-300">åœŸ</span>)
            </span>
        
            <!-- å³æ—¥ä»˜ï¼ˆåˆæœŸå·¦ç«¯ã€ã‚¹ãƒ©ã‚¤ãƒ‰ã§å³ç«¯ã¸ï¼‰ -->
            <span class="text-white date date-right absolute top-1/2 left-1 transform -translate-y-1/2 w-32 h-10 flex items-center justify-center font-semibold z-10 pointer-events-none transition-all duration-700 ease-in-out opacity-0">
              7æœˆ19æ—¥(<span class="text-red-200">æ—¥</span>)
            </span>
          </label>
        </div>

      <div style="height: 24px;"></div>
      <div class="flex justify-center">
      <div id="tableContainer" class="mx-auto overflow-auto max-h-[640px] max-w-[64rem] border rounded-md shadow-md bg-gray-50 relative">
        <div class="min-w-[810px] relative z-0">

          <table id="timetable" class="border-collapse w-full text-sm relative table-fixed">
            <thead class="table_color sticky top-0 z-[50]">
              <tr>
                <th class="sticky left-0 table_color z-[60] border-b px-4 py-2 text-left text-center w-14"></th>
                {venues.map((venue, i) => (
                  <th class="h-[60px] px-4 py-2 text-center text-white font-medium relative border-b zen-kaku-gothic-new"
                      style={`width: ${venueWidths[i]}px;`}>
                    {venue}
                  </th>
                ))}
              </tr>
            </thead>
            <tbody>
              {times.map(time => (
                <tr data-time={time} class="h-[60px] border-gray-200">
                  <td class="absolute sticky text-black bg-white text-center left-0 z-[10] px-2 py-2 font-medium zen-kaku-gothic-new">{time}</td>
                  {venues.map((_, i) => (
                    <td class="border-t relative px-4 py-2" style={`width: ${venueWidths[i]}px;`}></td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>

          <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒ–ãƒ­ãƒƒã‚¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
          <div id="eventsLayer" class="absolute top-0 left-0 w-full h-full zen-kaku-gothic-new"></div>

          <!-- ç¾åœ¨æ™‚åˆ»ãƒãƒ¼ -->
          <div id="currentTimeBar"
     class="absolute h-[2px] bg-red-500 z-[0] max-md:w-[100%] md:w-[100%]"
     style="left: 0; top: 0;"></div>
          <div id="currentTimeLabel" class="absolute left-[44%] -translate-y-1/2 bg-red-500 text-xs text-white px-2 py-[2px] rounded-full shadow z-[20] zen-kaku-gothic-new" style="top:0;">ç¾åœ¨ --</div>
        </div>
      </div>
      </div>
      <div style="height: 30px"></div>
      <div class="ml-1">
        <p>â€»ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚„æ™‚é–“ã¯å¤‰æ›´ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚<br>
          â€»è¡¨ç¤ºã®éƒ½åˆä¸Šã€ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ãªã©ãŒè¦‹ãˆã¥ã‚‰ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
        </p>
      </div>
      <div style="height: 120px"></div>
    

      
    </div>
  </div>

  <script>
    const container = document.getElementById("tableContainer")!;
    const tbody = document.querySelector("#timetable tbody")!;
    const eventsLayer = document.getElementById("eventsLayer")!;

    // ğŸ”¸ æ—¥ä»˜ã”ã¨ã®ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
    const eventsData = {
      "7/18": [
        { start: "12:00", end: "13:00", venue: "ç ”ä¿®å®¤AB", name: "å—ä»˜", description: "", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "12:30", end: "13:00", venue: "å’Œå®¤å°", name: "å—ä»˜", description: "", color: "bg-purple-300", target: "ä¸­é«˜ç”Ÿä¿è­·è€…ã®æ–¹" },
        { start: "13:00", end: "16:35", venue: "å’Œå®¤å°", name: "ä¿è­·è€…åº§è«‡ä¼š", description: "ä¸­é«˜ç”Ÿäº¤æµä¼šã®é–‹å‚¬ã«ä½µã›ã€åˆ¥å®¤ã«ã¦ä¸­é«˜ç”Ÿã®ä¿è­·è€…ã®æ–¹ã‚’å¯¾è±¡ã¨ã—ãŸåº§è«‡ä¼šã‚’é–‹å‚¬ã—ã¾ã™ã€‚<br>ãŠå­ã•ã‚“ãŒäº¤æµä¼šã‚’æ¥½ã—ã‚“ã§ã„ã‚‹é–“ã€ä¿è­·è€…ã®æ–¹åŒå£«ã§æ°—å…¼ã­ãªããŠè©±ã—ã—ã¾ã—ã‚‡ã†ã€‚", color: "bg-purple-300", target: "ä¸­é«˜ç”Ÿä¿è­·è€…ã®æ–¹" },
        { start: "13:00", end: "13:15", venue: "ç ”ä¿®å®¤AB", name: "é–‹ä¼šå¼", description: "å®Ÿè¡Œå§”å“¡é•·ã®æŒ¨æ‹¶ã‚„ã€ã†ãƒãƒ¼ã™ãŸã®ã”ç´¹ä»‹ãªã©ã‚’è¡Œã„ã¾ã™ã€‚<br>æ¥½ã—ã„2æ—¥é–“ã®å§‹ã¾ã‚Šã§ã™ï¼", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "13:25", end: "14:40", venue: "ç ”ä¿®å®¤AB", name: "ã‚°ãƒ«ãƒ¼ãƒ—ãƒˆãƒ¼ã‚¯", description: "ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†ã‹ã‚Œã¦ã‚°ãƒ«ãƒ¼ãƒ—ãƒˆãƒ¼ã‚¯ã‚’è¡Œã„ã¾ã™ã€‚<br>åƒéŸ³ã®ã“ã¨ã ã‘ã§ãªãã€è¶£å‘³ã‚„ä»•äº‹ã®è©±ãªã©ã•ã¾ã–ã¾ã€‚", color: "bg-green-300", target: "å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "13:25", end: "14:40", venue: "ç ”ä¿®å®¤C", name: "ã‚¢ã‚¤ã‚¹ãƒ–ãƒ¬ã‚¤ã‚¯ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ãƒˆãƒ¼ã‚¯", description: "å°‘äººæ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†ã‹ã‚Œã¦ã€åƒéŸ³ã®ã“ã¨ã‚„è¶£å‘³ãªã©æ¥½ã—ããŠè©±ã—ã—ã¾ã—ã‚‡ã†ï¼<br>ä¸Šæ‰‹ãè©±ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã¡ã‚ã‚“æ™‚é–“ãŒæ›ã‹ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã€‚", color: "bg-blue-300", target: "ä¸­é«˜ç”Ÿ" },
        { start: "14:50", end: "15:55", venue: "ç ”ä¿®å®¤AB", name: "ãƒ“ãƒ³ã‚´å¤§ä¼š", description: "è±ªè¯æ™¯å“ãŒå½“ãŸã‚‹ã‹ã‚‚ï¼ï¼Ÿ", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "16:40", end: "17:00", venue: "å¤§é˜ªå›½éš›ãƒ¦ãƒ¼ã‚¹ãƒ›ã‚¹ãƒ†ãƒ«", name: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³", description: "", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "17:00", end: "19:30", venue: "ãƒãƒ¼ãƒ™ã‚­ãƒ¥ãƒ¼ã‚¬ãƒ¼ãƒ‡ãƒ³ç¾½è¡£", name: "BBQ", description: "ã¿ã‚“ãªã§BBQã‚’æ¥½ã—ã¿ã¾ã—ã‚‡ã†ï¼", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "19:30", end: "20:00", venue: "ãƒãƒ¼ãƒ™ã‚­ãƒ¥ãƒ¼ã‚¬ãƒ¼ãƒ‡ãƒ³ç¾½è¡£", name: "èŠ±ç«@æµœå¯ºå…¬åœ’", description: "å¤ã®é¢¨ç‰©è©©ã€èŠ±ç«ã§ã€1æ—¥ã®æœ€å¾Œã‚’ç· ã‚ããã‚Šã¾ã—ã‚‡ã†ï¼<br>ãƒãƒ¼ãƒ™ã‚­ãƒ¥ãƒ¼ã‚¬ãƒ¼ãƒ‡ãƒ³ç¾½è¡£æ¨ªã®æµœå¯ºå…¬åœ’ã«ã¦è¡Œã„ã¾ã™ã€‚", color: "bg-blue-300", target: "ä¸­é«˜ç”Ÿ" },
        { start: "20:00", end: "23:00", venue: "å¤§é˜ªå›½éš›ãƒ¦ãƒ¼ã‚¹ãƒ›ã‚¹ãƒ†ãƒ«", name: "ãƒ•ãƒªãƒ¼ã‚¿ã‚¤ãƒ ", description: "å…¥æµ´ã‚„ãƒ­ãƒ“ãƒ¼ã§ã®æ­“è«‡ãªã©ã€æ€ã„æ€ã„ã«ãŠéã”ã—ãã ã•ã„ã€‚", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
      ],
      "7/19": [
        { start: "07:45", end: "08:25", venue: "å¤§é˜ªå›½éš›ãƒ¦ãƒ¼ã‚¹ãƒ›ã‚¹ãƒ†ãƒ«", name: "æœé£Ÿ", description: "", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "08:30", end: "09:00", venue: "å¤§é˜ªå›½éš›ãƒ¦ãƒ¼ã‚¹ãƒ›ã‚¹ãƒ†ãƒ«", name: "ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ", description: "", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "09:05", end: "10:40", venue: "ç ”ä¿®å®¤C", name: "ãƒ—ãƒ©æ¿ã¥ãã‚Š", description: "ãƒ†ãƒ¼ãƒã«æ²¿ã£ã¦ã€ã¿ã‚“ãªã§ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ—ãƒ©æ¿ã‚’ä½œã‚Šã¾ã™ï¼<br>ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯æ¿ã‚’ä½¿ç”¨ã™ã‚‹äºˆå®šã§ã™ã€‚<br>â€»å¸Œæœ›è€…ã¯ãƒ¬ã‚¸ãƒ³ï¼ˆãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰å·¥ä½œã«ä½¿ã†æ¨¹è„‚ï¼‰ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚", color: "bg-blue-300", target: "ä¸­é«˜ç”Ÿ" },
        { start: "09:05", end: "9:35", venue: "ç ”ä¿®å®¤AB", name: "ã‚°ãƒ«ãƒ¼ãƒ—ãƒˆãƒ¼ã‚¯", description: "ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†ã‹ã‚Œã¦ã‚°ãƒ«ãƒ¼ãƒ—ãƒˆãƒ¼ã‚¯ã‚’è¡Œã„ã¾ã™ã€‚<br>åƒéŸ³ã®ã“ã¨ã ã‘ã§ãªãã€è¶£å‘³ã‚„ä»•äº‹ã®è©±ãªã©ã•ã¾ã–ã¾ã€‚", color: "bg-green-300", target: "å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "09:35", end: "10:40", venue: "ç ”ä¿®å®¤AB", name: "ãƒã‚¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸", description: "åƒéŸ³ã«ã¾ã¤ã‚ã‚‹ä½“é¨“ã€æ€ã„ã€ã¿ã‚“ãªã«ä¼ãˆãŸã„ã“ã¨ãªã©ã‚’è‡ªç”±ã«ç™ºè¡¨ã—ã¦ã„ãŸã ããƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ã€‚<br>â€»å¸Œæœ›è€…ã®ã¿", color: "bg-green-300", target: "å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "10:50", end: "12:00", venue: "ç ”ä¿®å®¤AB", name: "ã‚¯ã‚¤ã‚ºå¤§ä¼š", description: "ãƒãƒ¼ãƒ ã§å¯¾æŠ—ã—ã¦ãƒã‚¤ãƒ³ãƒˆã‚’ç«¶ã„åˆã„ã¾ã™ï¼", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
        { start: "12:00", end: "12:20", venue: "ç ”ä¿®å®¤AB", name: "é–‰ä¼šå¼", description: "æ¥½ã—ã‹ã£ãŸ2æ—¥é–“ã‚‚ã“ã‚Œã§ãŠã—ã¾ã„ã€‚<br>æœ€å¾Œã¾ã§ã¿ã‚“ãªã¨åŒã˜ã¨ãã‚’éã”ã—ã¾ã—ã‚‡ã†ã€‚", color: "", target: "ä¸­é«˜ç”Ÿãƒ»å­¦ç”Ÿãƒ»ç¤¾ä¼šäºº" },
      ]
    };

    let currentDate = "7/18";
    let eventsList: any[] = [];

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’ç”Ÿæˆ
    function renderEvents() {
      eventsLayer.innerHTML = "";
      eventsList = eventsData[currentDate].map(ev => {
        const div = document.createElement("div");
        
        // â–¼ ä¿®æ­£ç®‡æ‰€ã“ã“ã‹ã‚‰ â–¼
        // ãƒ‡ãƒ¼ã‚¿ã« color ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã„ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ bg-yellow-300 ã‚’ä½¿ã†
        const bgColor = ev.color ? ev.color : "bg-yellow-300";
        
        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«ã‚’ä½¿ã£ã¦ã‚¯ãƒ©ã‚¹åã‚’å‹•çš„ã«åŸ‹ã‚è¾¼ã¿ã¾ã™
        div.className = `event-block rounded absolute ${bgColor} border border-gray-300 text-black px-2 py-2 z-[0] flex flex-col cursor-pointer hover:opacity-90 transition-opacity hover:z-[30]`;
        // â–² ä¿®æ­£ç®‡æ‰€ã“ã“ã¾ã§ â–²

        const title = document.createElement("div");
        title.className = "font-medium text-sm";
        title.textContent = ev.name;
        const time = document.createElement("div");
        time.className = "text-xs text-black mt-1";
        time.textContent = `${ev.start}ã€œ${ev.end}`;
        div.appendChild(title);
        div.appendChild(time);
        eventsLayer.appendChild(div);
        ev.div = div;
        return ev;
      });
      positionEvents();
      setupModal();
    }

    function positionEvents() {
      const containerRect = container.getBoundingClientRect();
      const rows = [...tbody.querySelectorAll("tr")];

      eventsList.forEach(ev => {
        const venueIndex = ["ç ”ä¿®å®¤AB","ç ”ä¿®å®¤C","å’Œå®¤å°","å¤§é˜ªå›½éš›ãƒ¦ãƒ¼ã‚¹ãƒ›ã‚¹ãƒ†ãƒ«","ãƒãƒ¼ãƒ™ã‚­ãƒ¥ãƒ¼ã‚¬ãƒ¼ãƒ‡ãƒ³ç¾½è¡£"].indexOf(ev.venue);
        if (venueIndex === -1) return;

        const td = tbody.querySelectorAll("tr:first-child td")[venueIndex + 1]!;
        const tdRect = td.getBoundingClientRect();

        const [sh, sm] = ev.start.split(":").map(Number);
        const [eh, em] = ev.end.split(":").map(Number);
        const startMinutes = sh*60 + sm;
        const endMinutes = eh*60 + em;

        let baseRow = rows[0]!;
        for (let row of rows) {
          const rowMinutes = row.dataset.time!.split(":").map(Number).reduce((h,m)=>h*60+m);
          if (rowMinutes <= startMinutes) baseRow = row;
          else break;
        }
        const nextRow = baseRow.nextElementSibling || baseRow;
        const baseRect = baseRow.getBoundingClientRect();
        const nextRect = nextRow.getBoundingClientRect();
        const rowStartMinutes = baseRow.dataset.time!.split(":").map(Number).reduce((h,m)=>h*60+m);
        const ratio = (startMinutes - rowStartMinutes)/60;
        const topPx = baseRect.top - containerRect.top + ratio*(nextRect.top - baseRect.top) + container.scrollTop;
        const heightPx = (endMinutes - startMinutes)/60 * baseRect.height;
        const widthPx = tdRect.width;
        ev.div.style.top = `${topPx}px`;
        ev.div.style.left = `${tdRect.left - containerRect.left + container.scrollLeft - 1.5}px`;
        ev.div.style.width = `${widthPx}px`;
        ev.div.style.height = `${heightPx}px`;
      });
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«è¨­å®šé–¢æ•°
    function setupModal() {
      const modal = document.getElementById("eventModal")!;
      const modalTitle = document.getElementById("modalTitle")!;
      const modalDescription = document.getElementById("modalDescription")!;
      const modalTime = document.getElementById("modalTime")!;
      
      const modalVenue = document.getElementById("modalVenue")!;
      const modalTarget = document.getElementById("modalTarget")!;

      const modalClose = document.getElementById("modalClose")!;

      eventsList.forEach(ev => {
        ev.div.addEventListener("click", () => {
          modalTitle.textContent = ev.name;
          modalDescription.innerHTML = ev.description || "è©³ç´°æƒ…å ±ãªã—";
          modalVenue.textContent = `å ´æ‰€ï¼š${ev.venue}`;
          modalTarget.textContent = ev.target ? `å¯¾è±¡ï¼š${ev.target}` : "";

          modalTime.textContent = `æ™‚é–“ï¼š${ev.start}ã€œ${ev.end}`;
          modal.classList.remove("hidden");
          modal.classList.add("flex");
        });
      });

      modalClose.addEventListener("click", () => modal.classList.add("hidden"));
      modal.addEventListener("click", e => {
        if (e.target === modal) modal.classList.add("hidden");
      });
    }

    // ç¾åœ¨æ™‚åˆ»ãƒãƒ¼æ›´æ–°
    const bar = document.getElementById("currentTimeBar")!;
    const label = document.getElementById("currentTimeLabel")!;
    function updateTimeBar() {
      const now = new Date();
      const currentMinutes = now.getHours()*60 + now.getMinutes();
      const rows = [...tbody.querySelectorAll("tr")] as HTMLTableRowElement[];
      let visible = false;
      for (let i=0; i<rows.length-1; i++) {
        const [sh,sm] = rows[i]!.dataset.time!.split(":").map(Number);
        const [eh,em] = rows[i+1]!.dataset.time!.split(":").map(Number);
        const startM = sh!*60 + sm!;
        const endM = eh!*60 + em!;
        if (currentMinutes >= startM && currentMinutes < endM) {
          const startRect = rows[i]!.getBoundingClientRect();
          const endRect = rows[i+1]!.getBoundingClientRect();
          const parentRect = container.getBoundingClientRect();
          const ratio = (currentMinutes - startM)/(endM - startM);
          const offset = startRect.top + ratio*(endRect.top - startRect.top);
          const topPos = offset - parentRect.top + container.scrollTop;
          bar.style.top = `${topPos}px`;
          label.style.top = `${topPos}px`;
          label.textContent = `ç¾åœ¨æ™‚åˆ» ${String(now.getHours()).padStart(2,"0")}:${String(now.getMinutes()).padStart(2,"0")}`;
          visible = true;
          break;
        }
      }
      if (!visible) { bar.style.top = "-9999px"; label.style.top = "-9999px"; }
    }

    

    // åˆæœŸæç”»
    renderEvents();
    updateTimeBar();
    setInterval(updateTimeBar, 30000);
    container.addEventListener("scroll", positionEvents);
    window.addEventListener("resize", positionEvents);

    // ğŸ”¸ æ—¥ä»˜åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³å‡¦ç†
    document.querySelectorAll(".date-btn").forEach(btn => {
  const button = btn as HTMLButtonElement;
  button.addEventListener("click", () => {
    document.querySelectorAll(".date-btn").forEach(b =>
      (b as HTMLButtonElement).classList.remove("bg-blue-300", "text-blue-800")
    );
    button.classList.add("bg-blue-300", "text-blue-800");
    currentDate = button.dataset.date!;
    renderEvents();
  });
});


    const toggle = document.getElementById("dateToggle")! as HTMLInputElement;;

toggle.addEventListener("change", () => {
  currentDate = toggle.checked ? "7/19" : "7/18";
  renderEvents();
});
  </script>
</Layout>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[20000] zen-kaku-gothic-new">
  <div class="bg-white p-6 rounded-3xl shadow-lg max-w-sm w-2/3 relative">
    <button id="modalClose" class="absolute top-3 right-6 text-gray-500 hover:text-black text-[24px]">&times;</button>
    <h3 id="modalTitle" class="font-bold text-lg mb-2 pr-8"></h3>
    
    <p id="modalTime" class="text-sm text-black mt-2"></p>
    <p id="modalVenue" class="text-sm text-black mt-1"></p>
    <p id="modalTarget" class="text-sm text-black mt-1 font-medium"></p>
    <div style="height: 10px"></div>
    <p id="modalDescription" class="text-sm text-black whitespace-pre-wrap"></p>
    
  </div>
</div>
